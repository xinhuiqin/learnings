《排序算法3：希尔排序(Shell sort)》
---------------------------------------------------------

# 历史

根据首字母大写的“Shell”我们就可以猜测到这是一个用人名命名的排序算法。不错，该算法是由美国计算机科学家：唐纳德.希尔（Donal Shell）于1959年提出。国外命名一般采用姓。Donal是一个非常普遍的名字，如著名的图灵奖获得者唐纳德·克努特（Donald Ervin Knuth）也是这个名字。

# 定义

希尔排序是一种基于插入排序，采用“变动间隔”技术进行排序的算法。

# 原理

假设我们要对序列”49, 38, 65, 97, 76, 13, 27, 49, 55, 4“进行排序，该序列共有10个元素，所以长度为10。那么按照希尔排序算法可做如下拆解。

1、设置第一个间隔。取一个小于序列长度(用length表示)的整数作为间隔（用gap表示），这里取gap = 10 / 2 = 5，这样整个序列便被分成了5组，分别为[49, 13]、[38, 27]、[65, 49]、[97, 55]、[76, 4]。

2、运用插入排序算法进行排序。排序之后我们便可以得到"13, 27, 49, 55, 4, 49, 38, 65, 97, 76"。

3、“变动间隔”：取gap =  5 / 2 = 2，这样数组便被分成了2组，分别为[13, 49, 4, 38, 97]、[27, 55, 49, 65, 76]。

4、运用插入排序算法进行排序。排序之后我们便可以得到"4, 27, 13, 49, 38, 55, 49, 65, 97, 76"。

5、“变动间隔”：取gap = 2 / 2 = 1，这样数组便被分成了一组，为[4, 27, 13, 49, 38, 55, 49, 65, 97, 76]。

6、运用插入排序算法进行排序。排序之后我们便可以得到“4, 13,  27, 38, 49, 49, 55,  65, 76, 97”。

注：

（1）最后一次间隔为1，而gap //= 2的最小值是0，所以gap跳出循环的条件是while > 0。

（2）设间隔h，则第j个元素与间隔为h的第i个元素的关系为：h = j - i。

# 算法分析

1、时间复杂度：O(n^3/2^)，突破了O(n^2^)。

2、空间复杂度：希尔排序时间复杂度的下界是n*log2n。

# 参考资料

[1] Robert Sedgewick, Kevin Wayne. 算法(第4版)[M]. 北京: 人民邮电出版社, 2016.

[2] 裘宗燕. 数据结构与算法[M]. 北京:  机械工业出版社, 2017.

[3] 裘宗燕, http://www.math.pku.edu.cn/teachers/qiuzy/ds_python/courseware/index.htm

# 代码实现(Python)

1、插入排序需要进行稍微调整，即以每一组的第一个元素为开始，而不是0。

```
class Solution:
    def shell_sort(self, lst):
        n = len(lst)
        gap = n // 2
        # gap //= 2一直重复的结果是0，所以循环的条件是gap > 0
        while gap > 0:
            # 从gap开始，每组交叉比较
            for i in range(gap, n):
                # 插入排序
                tmp = lst[i]
                j = i
                while j > 0 and lst[j-gap] > tmp:  # 前一个元素是j-gap
                    # 前一个元素后移一个位置
                    lst[j] = lst[j-gap]
                    # 索引指针前移一个位置
                    j -= gap
                lst[j] = tmp
            gap //= 2
        return lst


if __name__ == '__main__':
    example = [49, 38, 65, 97, 76, 13, 27, 49, 55, 4]
    s = Solution()
    res = s.shell_sort(example)
    print(res)  # [4, 13, 27, 38, 49, 49, 55, 65, 76, 97]

```

